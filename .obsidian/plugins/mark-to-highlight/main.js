/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var h=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var C=(n,s)=>{for(var t in s)h(n,t,{get:s[t],enumerable:!0})},x=(n,s,t,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let e of k(s))!m.call(n,e)&&e!==t&&h(n,e,{get:()=>s[e],enumerable:!(i=w(s,e))||i.enumerable});return n};var y=n=>x(h({},"__esModule",{value:!0}),n);var D={};C(D,{default:()=>l});module.exports=y(D);var o=require("obsidian"),H={autoConvertDelay:500};function b(n,s){let t=!1,i="";for(let e=0;e<=s;e++){let r=n[e].match(/^(```|~~~)/);r&&(t?r[1]===i&&(t=!1,i=""):(t=!0,i=r[1]))}return t}function E(n){let s=!1,t="",i=!1;for(let e=0;e<n.length;e++){if(n[e]==="`"){s=!s,t+=n[e];continue}if(!s&&n[e]==="="&&n[e+1]==="="){let a=n.indexOf("==",e+2);if(a!==-1){let r=n.substring(e+2,a);t+=`<mark>${r}</mark>`,e=a+1,i=!0;continue}}t+=n[e]}return{newLine:t,replaced:i}}function u(n,s){let t;return()=>{t!==void 0&&clearTimeout(t),t=window.setTimeout(()=>{n()},s)}}var l=class extends o.Plugin{async onload(){await this.loadSettings(),this.addCommand({id:"convert-highlight",name:"Convert ==xxx== to <mark>xxx</mark>",editorCallback:(t,i)=>{this.convertHighlight(t)}}),this.onEditHandler=u(()=>{let t=this.app.workspace.getActiveViewOfType(o.MarkdownView);if(t){let i=t.editor;this.convertHighlight(i)}},this.settings.autoConvertDelay),this.registerEvent(this.app.workspace.on("editor-change",this.onEditHandler)),this.addSettingTab(new g(this.app,this))}onunload(){console.log("Mark to Highlight Plugin Unloaded.")}async loadSettings(){this.settings=Object.assign({},H,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}updateAutoConvertDelay(t){this.settings.autoConvertDelay=t,this.saveSettings(),this.app.workspace.off("editor-change",this.onEditHandler),this.onEditHandler=u(()=>{let i=this.app.workspace.getActiveViewOfType(o.MarkdownView);if(i){let e=i.editor;this.convertHighlight(e)}},this.settings.autoConvertDelay),this.registerEvent(this.app.workspace.on("editor-change",this.onEditHandler))}convertHighlight(t){let i=t.getCursor(),e=i.line,a=t.getLine(e),r=t.getValue().split(`
`);if(b(r,e))return;let{newLine:c,replaced:p}=E(a);if(p){let f=a.substring(0,i.ch);t.setLine(e,c);let d=c.indexOf("</mark>",f.length);if(d!==-1){let v=d+7;t.setCursor({line:e,ch:v})}else t.setCursor({line:e,ch:c.length});new o.Notice("\u2728 Markdown Highlight Converted Automatically!")}}},g=class extends o.PluginSettingTab{constructor(t,i){super(t,i);this.plugin=i}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Mark to Highlight \u8BBE\u7F6E"}),new o.Setting(t).setName("\u81EA\u52A8\u8F6C\u6362\u5EF6\u8FDF\uFF08\u6BEB\u79D2\uFF09").setDesc("\u8BBE\u7F6E\u81EA\u52A8\u8BC6\u522B\u5E76\u8F6C\u6362 ==xxx== \u7684\u5EF6\u8FDF\u65F6\u95F4\uFF0C\u9ED8\u8BA4500\u6BEB\u79D2\u3002").addText(i=>i.setPlaceholder("500").setValue(this.plugin.settings.autoConvertDelay.toString()).onChange(async e=>{let a=parseInt(e);!isNaN(a)&&a>=0?(this.plugin.updateAutoConvertDelay(a),new o.Notice(`\u81EA\u52A8\u8F6C\u6362\u5EF6\u8FDF\u5DF2\u8BBE\u7F6E\u4E3A ${a} \u6BEB\u79D2`)):new o.Notice("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u6BEB\u79D2\u6570\uFF08\u975E\u8D1F\u6574\u6570\uFF09\u3002")}))}};
